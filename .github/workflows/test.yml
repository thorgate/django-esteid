name: CI
on: [push]
jobs:
  build:
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
       include:
         # Can't enable this as it requires a custom runner.
         #- python: "3.6"
         #  DJANGO: "1.11"
         #  os: ubuntu-16.07

         - python: "3.6"
           DJANGO: "2.0"
           os: ubuntu-latest

         - python: "3.6"
           DJANGO: "3.0"
           os: ubuntu-latest

         - python: "3.7"
           DJANGO: "2.1"
           COVERALLS: 1
           os: ubuntu-latest

         - python: "3.8"
           DJANGO: "2.0"
           os: ubuntu-latest

         - python: "3.8"
           DJANGO: "3.0"
           os: ubuntu-latest
    steps:
      - name: Setup python for test ${{ matrix.python }}
        uses: actions/setup-python@v2
        with:
          python-version: ${{ matrix.python }}
      - name: Add poetry
        uses: abatilo/actions-poetry@v2.1.3
        with:
          poetry-version: "1.1.11"
      - uses: actions/checkout@v2
      - name: Install tox
        run: python -m pip install tox
      - name: Run ci
        run: tox
        env:
          TOXENV: "py${{ matrix.python }}-django${{ matrix.DJANGO }}"
      - name: Publish coverage
        uses: coverallsapp/github-action@master
        with:
          github-token: ${{ secrets.COVERALLS_TOKEN }}
        if: ${{ matrix.COVERALLS == '1' }}
