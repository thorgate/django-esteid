!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Esteid=e():t.Esteid=e()}(window,function(){return function(t){var e={};function i(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=6)}([function(t,e,i){var r,n=i(2),s=i(3),o=i(4),a=i(1);function u(){}function h(t){switch({}.toString.call(t)){case"[object File]":case"[object Blob]":case"[object FormData]":return!0;default:return!1}}r="undefined"!=typeof window?window:"undefined"!=typeof self?self:this;var c=t.exports=i(5).bind(null,g);c.getXHR=function(){if(!(!r.XMLHttpRequest||r.location&&"file:"==r.location.protocol&&r.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(t){}return!1};var l="".trim?function(t){return t.trim()}:function(t){return t.replace(/(^\s*|\s*$)/g,"")};function d(t){if(!a(t))return t;var e=[];for(var i in t)null!=t[i]&&p(e,i,t[i]);return e.join("&")}function p(t,e,i){if(Array.isArray(i))return i.forEach(function(i){p(t,e,i)});t.push(encodeURIComponent(e)+"="+encodeURIComponent(i))}function f(t){for(var e,i={},r=t.split("&"),n=0,s=r.length;n<s;++n)e=r[n].split("="),i[decodeURIComponent(e[0])]=decodeURIComponent(e[1]);return i}function y(t){return/[\/+]json\b/.test(t)}function m(t,e){e=e||{},this.req=t,this.xhr=this.req.xhr,this.text="HEAD"!=this.req.method&&(""===this.xhr.responseType||"text"===this.xhr.responseType)||void 0===this.xhr.responseType?this.xhr.responseText:null,this.statusText=this.req.xhr.statusText,this.setStatusProperties(this.xhr.status),this.header=this.headers=function(t){var e,i,r,n,s=t.split(/\r?\n/),o={};s.pop();for(var a=0,u=s.length;a<u;++a)e=(i=s[a]).indexOf(":"),r=i.slice(0,e).toLowerCase(),n=l(i.slice(e+1)),o[r]=n;return o}(this.xhr.getAllResponseHeaders()),this.header["content-type"]=this.xhr.getResponseHeader("content-type"),this.setHeaderProperties(this.header),this.body="HEAD"!=this.req.method?this.parseBody(this.text?this.text:this.xhr.response):null}function g(t,e){var i=this;this._query=this._query||[],this.method=t,this.url=e,this.header={},this._header={},this.on("end",function(){var t=null,e=null;try{e=new m(i)}catch(e){return(t=new Error("Parser is unable to parse the response")).parse=!0,t.original=e,t.rawResponse=i.xhr&&i.xhr.responseText?i.xhr.responseText:null,t.statusCode=i.xhr&&i.xhr.status?i.xhr.status:null,i.callback(t)}if(i.emit("response",e),t)return i.callback(t,e);if(e.status>=200&&e.status<300)return i.callback(t,e);var r=new Error(e.statusText||"Unsuccessful HTTP response");r.original=t,r.response=e,r.status=e.status,i.callback(r,e)})}for(var _ in c.serializeObject=d,c.parseString=f,c.types={html:"text/html",json:"application/json",xml:"application/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"},c.serialize={"application/x-www-form-urlencoded":d,"application/json":JSON.stringify},c.parse={"application/x-www-form-urlencoded":f,"application/json":JSON.parse},m.prototype.get=function(t){return this.header[t.toLowerCase()]},m.prototype.setHeaderProperties=function(t){var e=this.header["content-type"]||"";this.type=e.split(/ *; */).shift();var i=function(t){return s(t.split(/ *; */),function(t,e){var i=e.split(/ *= */),r=i.shift(),n=i.shift();return r&&n&&(t[r]=n),t},{})}(e);for(var r in i)this[r]=i[r]},m.prototype.parseBody=function(t){var e=c.parse[this.type];return!e&&y(this.type)&&(e=c.parse["application/json"]),e&&t&&(t.length||t instanceof Object)?e(t):null},m.prototype.setStatusProperties=function(t){1223===t&&(t=204);var e=t/100|0;this.status=this.statusCode=t,this.statusType=e,this.info=1==e,this.ok=2==e,this.clientError=4==e,this.serverError=5==e,this.error=(4==e||5==e)&&this.toError(),this.accepted=202==t,this.noContent=204==t,this.badRequest=400==t,this.unauthorized=401==t,this.notAcceptable=406==t,this.notFound=404==t,this.forbidden=403==t},m.prototype.toError=function(){var t=this.req,e=t.method,i=t.url,r="cannot "+e+" "+i+" ("+this.status+")",n=new Error(r);return n.status=this.status,n.method=e,n.url=i,n},c.Response=m,n(g.prototype),o)g.prototype[_]=o[_];function b(t,e){var i=c("DELETE",t);return e&&i.end(e),i}g.prototype.abort=function(){if(!this.aborted)return this.aborted=!0,this.xhr&&this.xhr.abort(),this.clearTimeout(),this.emit("abort"),this},g.prototype.type=function(t){return this.set("Content-Type",c.types[t]||t),this},g.prototype.responseType=function(t){return this._responseType=t,this},g.prototype.accept=function(t){return this.set("Accept",c.types[t]||t),this},g.prototype.auth=function(t,e,i){switch(i||(i={type:"basic"}),i.type){case"basic":var r=btoa(t+":"+e);this.set("Authorization","Basic "+r);break;case"auto":this.username=t,this.password=e}return this},g.prototype.query=function(t){return"string"!=typeof t&&(t=d(t)),t&&this._query.push(t),this},g.prototype.attach=function(t,e,i){return this._getFormData().append(t,e,i||e.name),this},g.prototype._getFormData=function(){return this._formData||(this._formData=new r.FormData),this._formData},g.prototype.send=function(t){var e=a(t),i=this._header["content-type"];if(e&&a(this._data))for(var r in t)this._data[r]=t[r];else"string"==typeof t?(i||this.type("form"),i=this._header["content-type"],this._data="application/x-www-form-urlencoded"==i?this._data?this._data+"&"+t:t:(this._data||"")+t):this._data=t;return!e||h(t)?this:(i||this.type("json"),this)},m.prototype.parse=function(t){return r.console&&console.warn("Client-side parse() method has been renamed to serialize(). This method is not compatible with superagent v2.0"),this.serialize(t),this},m.prototype.serialize=function(t){return this._parser=t,this},g.prototype.callback=function(t,e){var i=this._callback;this.clearTimeout(),i(t,e)},g.prototype.crossDomainError=function(){var t=new Error("Request has been terminated\nPossible causes: the network is offline, Origin is not allowed by Access-Control-Allow-Origin, the page is being unloaded, etc.");t.crossDomain=!0,t.status=this.status,t.method=this.method,t.url=this.url,this.callback(t)},g.prototype.timeoutError=function(){var t=this._timeout,e=new Error("timeout of "+t+"ms exceeded");e.timeout=t,this.callback(e)},g.prototype.withCredentials=function(){return this._withCredentials=!0,this},g.prototype.end=function(t){var e=this,i=this.xhr=c.getXHR(),r=this._query.join("&"),n=this._timeout,s=this._formData||this._data;this._callback=t||u,i.onreadystatechange=function(){if(4==i.readyState){var t;try{t=i.status}catch(e){t=0}if(0==t){if(e.timedout)return e.timeoutError();if(e.aborted)return;return e.crossDomainError()}e.emit("end")}};var o=function(t){t.total>0&&(t.percent=t.loaded/t.total*100),t.direction="download",e.emit("progress",t)};this.hasListeners("progress")&&(i.onprogress=o);try{i.upload&&this.hasListeners("progress")&&(i.upload.onprogress=o)}catch(t){}if(n&&!this._timer&&(this._timer=setTimeout(function(){e.timedout=!0,e.abort()},n)),r&&(r=c.serializeObject(r),this.url+=~this.url.indexOf("?")?"&"+r:"?"+r),this.username&&this.password?i.open(this.method,this.url,!0,this.username,this.password):i.open(this.method,this.url,!0),this._withCredentials&&(i.withCredentials=!0),"GET"!=this.method&&"HEAD"!=this.method&&"string"!=typeof s&&!h(s)){var a=this._header["content-type"],l=this._parser||c.serialize[a?a.split(";")[0]:""];!l&&y(a)&&(l=c.serialize["application/json"]),l&&(s=l(s))}for(var d in this.header)null!=this.header[d]&&i.setRequestHeader(d,this.header[d]);return this._responseType&&(i.responseType=this._responseType),this.emit("request",this),i.send(void 0!==s?s:null),this},c.Request=g,c.get=function(t,e,i){var r=c("GET",t);return"function"==typeof e&&(i=e,e=null),e&&r.query(e),i&&r.end(i),r},c.head=function(t,e,i){var r=c("HEAD",t);return"function"==typeof e&&(i=e,e=null),e&&r.send(e),i&&r.end(i),r},c.del=b,c.delete=b,c.patch=function(t,e,i){var r=c("PATCH",t);return"function"==typeof e&&(i=e,e=null),e&&r.send(e),i&&r.end(i),r},c.post=function(t,e,i){var r=c("POST",t);return"function"==typeof e&&(i=e,e=null),e&&r.send(e),i&&r.end(i),r},c.put=function(t,e,i){var r=c("PUT",t);return"function"==typeof e&&(i=e,e=null),e&&r.send(e),i&&r.end(i),r}},function(t,e){t.exports=function(t){return null!=t&&"object"==typeof t}},function(t,e,i){function r(t){if(t)return function(t){for(var e in r.prototype)t[e]=r.prototype[e];return t}(t)}t.exports=r,r.prototype.on=r.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},r.prototype.once=function(t,e){function i(){this.off(t,i),e.apply(this,arguments)}return i.fn=e,this.on(t,i),this},r.prototype.off=r.prototype.removeListener=r.prototype.removeAllListeners=r.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var i,r=this._callbacks["$"+t];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var n=0;n<r.length;n++)if((i=r[n])===e||i.fn===e){r.splice(n,1);break}return this},r.prototype.emit=function(t){this._callbacks=this._callbacks||{};var e=[].slice.call(arguments,1),i=this._callbacks["$"+t];if(i)for(var r=0,n=(i=i.slice(0)).length;r<n;++r)i[r].apply(this,e);return this},r.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},r.prototype.hasListeners=function(t){return!!this.listeners(t).length}},function(t,e){t.exports=function(t,e,i){for(var r=0,n=t.length,s=3==arguments.length?i:t[r++];r<n;)s=e.call(null,s,t[r],++r,t);return s}},function(t,e,i){var r=i(1);e.clearTimeout=function(){return this._timeout=0,clearTimeout(this._timer),this},e.parse=function(t){return this._parser=t,this},e.timeout=function(t){return this._timeout=t,this},e.then=function(t,e){return this.end(function(i,r){i?e(i):t(r)})},e.use=function(t){return t(this),this},e.get=function(t){return this._header[t.toLowerCase()]},e.getHeader=e.get,e.set=function(t,e){if(r(t)){for(var i in t)this.set(i,t[i]);return this}return this._header[t.toLowerCase()]=e,this.header[t]=e,this},e.unset=function(t){return delete this._header[t.toLowerCase()],delete this.header[t],this},e.field=function(t,e){return this._getFormData().append(t,e),this}},function(t,e){t.exports=function(t,e,i){return"function"==typeof i?new t("GET",e).end(i):2==arguments.length?new t("GET",e):new t(e,i)}},function(t,e,i){"use strict";i.r(e);var r=i(0),n=i.n(r);const s="EST",o=[s,"ENG","RUS","LIT"];let a={user_cancel:{[s]:"Allkirjastamine katkestati",ENG:"Signing was cancelled",LIT:"Pasirašymas nutrauktas",RUS:"Подпись была отменена"},no_certificates:{[s]:"Sertifikaate ei leitud",ENG:"Certificate not found",LIT:"Nerastas sertifikatas",RUS:"Сертификат не найден"},invalid_argument:{[s]:"Vigane sertifikaadi identifikaator",ENG:"Invalid certificate identifier",LIT:"Neteisingas sertifikato identifikatorius",RUS:"Неверный идентификатор сертификата"},no_implementation:{[s]:"Vajalik tarkvara on puudu",ENG:"Unable to find software",LIT:"Nerasta programinės įranga",RUS:"Отсутствует необходимое программное обеспечение"},technical_error:{[s]:"Tehniline viga",ENG:"Technical error",LIT:"Techninė klaida",RUS:"Техническая ошибка"},not_allowed:{[s]:"Veebis allkirjastamise käivitamine on võimalik vaid https aadressilt",ENG:"Web signing is allowed only from https:// URL",LIT:"Web signing is allowed only from https:// URL",RUS:"Подпись в интернете возможна только с URL-ов, начинающихся с https://"}};var u=class{constructor(t){this.language=t||s,this._cert=null}initializeIdCard(){return new Promise(function(t,e){window.hwcrypto.use("auto")?t():e("Backend selection failed")})}getCertificate(){return new Promise((t,e)=>{let i={lang:this.language};window.hwcrypto.getCertificate(i).then(e=>{this._cert=e,t()},t=>{e(t)})})}signHexData(t){return new Promise((e,i)=>{let r={lang:this.language};window.hwcrypto.sign(this._cert,{type:"SHA-256",hex:t},r).then(t=>{this._signature=t,e()},t=>{i(t)})})}get prepareSignatureData(){return{tokenId:null,certData:this._cert.hex}}get finalizeSignatureData(){return{tokenId:null,signature:this._signature.hex}}get language(){return this._language}set language(t){-1!==o.indexOf(t)&&(this._language=t)}getError(t){return void 0!==a[t]?{error_code:t,message:a[t][this.language]}:{error_code:"technical_error",message:a.technical_error[this.language]}}};class h{constructor(t){const e={language:null,idEndpoints:{start:null,finish:null,finalize:null},midEndpoints:{start:null,status:null,finalize:null},smartidEndpoints:{start:null,status:null,finalize:null},...t};this.idCardManager=new u(e.language),this.idEndpoints=e.idEndpoints,this.midEndpoints=e.midEndpoints,this.smartidEndpoints=e.smartidEndpoints}checkStatus(t,e,i,r){const s=()=>{n.a.post(t).type("form").send(e).end((t,e)=>{e.ok?e.body.success?i(e.body):e.body.pending?setTimeout(()=>s(),1e3):r(e.body):r(e.body)})};return s}signWithIdCard(t){return new Promise((e,i)=>{this.__signHandleId(t,e,i)})}signWithMobileId(t){return new Promise((e,i)=>{this.__signHandleMid(t,e,i)})}signWithSmartId(t){return new Promise((e,i)=>{this.__signHandleSmartid(t,e,i)})}sign(t,e){if(t===h.SIGN_ID)return this.signWithIdCard(e);if(t===h.SIGN_MOBILE)return this.signWithMobileId(e);if(t===h.SIGN_SMARTID)return this.signWithSmartId(e);throw new TypeError("IdentificationManager: Bad signType")}__signHandleId(t,e,i){this.idCardManager.initializeIdCard().then(()=>{this.idCardManager.getCertificate().then(()=>{let r=this.idCardManager.prepareSignatureData;n.a.post(this.idEndpoints.start).type("form").send({certificate:r.certData,token_id:r.tokenId}).send(t).end((r,n)=>{n.ok&&n.body.success?this.__attemptSign(n.body.id,n.body.digest,t,e,i):i(n.body)})},i)},i)}__attemptSign(t,e,i,r,s){this.idCardManager.signHexData(e).then(()=>{let e=this.idCardManager.finalizeSignatureData;n.a.post(this.idEndpoints.finish).type("form").send({signature_value:e.signature,signature_id:t}).send(i).end((t,e)=>{e.ok&&e.body.success?r(e.body):s(e.body)})},s)}__signHandleMid(t,e,i){n.a.post(this.midEndpoints.start).type("form").send(t).end(function(t,r){r.ok&&r.body.success?e(r.body):i(r.body)})}midStatus(t,e){return new Promise((i,r)=>{if(t){this.checkStatus(this.midEndpoints.status,e,i,r)()}else r("skipped")})}__signHandleSmartid(t,e,i){n.a.post(this.smartidEndpoints.start).type("form").send(t).end(function(t,r){r.ok&&r.body.success?e(r.body):i(r.body)})}smartidStatus(t){return new Promise((e,i)=>{this.checkStatus(this.smartidEndpoints.status,t,e,i)()})}getError(t){return this.idCardManager.getError(t)}}h.SIGN_ID="id",h.SIGN_MOBILE="mid",h.SIGN_SMARTID="smartid";var c={IdentificationManager:h,Languages:{ET:s,EN:"ENG",RU:"RUS",LT:"LIT"}};e.default=c}]).default});